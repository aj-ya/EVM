const Web3 = require("web3");

const web3 = new Web3("http://192.168.49.2:31787");

async function run() {
  var accounts = await web3.eth.getAccounts();
  var electionContract = new web3.eth.Contract([
    { inputs: [], stateMutability: "nonpayable", type: "constructor" },
    {
      inputs: [{ internalType: "string", name: "choice", type: "string" }],
      name: "Vote",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [
        { internalType: "string[]", name: "_candidates", type: "string[]" },
      ],
      name: "addCandidates",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "admin",
      outputs: [{ internalType: "address", name: "", type: "address" }],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [{ internalType: "address", name: "from", type: "address" }],
      name: "checkVoted",
      outputs: [{ internalType: "bool", name: "", type: "bool" }],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "clearElection",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "commenceElection",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "concludeElection",
      outputs: [],
      stateMutability: "nonpayable",
      type: "function",
    },
    {
      inputs: [],
      name: "electionStarted",
      outputs: [{ internalType: "bool", name: "", type: "bool" }],
      stateMutability: "view",
      type: "function",
    },
    {
      inputs: [],
      name: "getCandidates",
      outputs: [
        {
          components: [
            { internalType: "string", name: "name", type: "string" },
            { internalType: "uint256", name: "voteCount", type: "uint256" },
          ],
          internalType: "struct Election.Candidate[]",
          name: "",
          type: "tuple[]",
        },
      ],
      stateMutability: "view",
      type: "function",
    },
  ]);
  var election = electionContract
    .deploy({
      data: "0x608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600360006101000a81548160ff0219169083151502179055506112d78061007b6000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c806381b8911a1161006657806381b8911a1461010c578063a999e56214610116578063cde419a414610132578063d5346da11461013c578063f851a4401461015a57610093565b806306a49fce1461009857806314b57ff1146100b657806328b44471146100c0578063323082d7146100f0575b600080fd5b6100a0610178565b6040516100ad9190610ddf565b60405180910390f35b6100be610273565b005b6100da60048036038101906100d59190610a6f565b6102e6565b6040516100e79190610e01565b60405180910390f35b61010a60048036038101906101059190610ae5565b61039c565b005b610114610573565b005b610130600480360381019061012b9190610a9c565b6105e7565b005b61013a6106e4565b005b610144610757565b6040516101519190610e01565b60405180910390f35b61016261076a565b60405161016f9190610dc4565b60405180910390f35b60606002805480602002602001604051908101604052809291908181526020016000905b8282101561026a57838290600052602060002090600202016040518060400160405290816000820180546101cf9061102e565b80601f01602080910402602001604051908101604052809291908181526020018280546101fb9061102e565b80156102485780601f1061021d57610100808354040283529160200191610248565b820191906000526020600020905b81548152906001019060200180831161022b57829003601f168201915b505050505081526020016001820154815250508152602001906001019061019c565b50505050905090565b60001515600360009054906101000a900460ff161515146102c9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102c090610e1c565b60405180910390fd5b6001600360006101000a81548160ff021916908315150217905550565b6000806000905060005b600180549050811015610392578373ffffffffffffffffffffffffffffffffffffffff166001828154811061032857610327611138565b5b906000526020600020906002020160010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16141561037f5760019150610392565b808061038a90611091565b9150506102f0565b5080915050919050565b600015156103a9336102e6565b1515146103eb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103e290610e3c565b60405180910390fd5b60005b60028054905081101561056f576002818154811061040f5761040e611138565b5b90600052602060002090600202016000016040516020016104309190610dad565b60405160208183030381529060405280519060200120826040516020016104579190610d96565b60405160208183030381529060405280519060200120141561055c576002818154811061048757610486611138565b5b906000526020600020906002020160010160008154809291906104a990611091565b9190505550600160405180604001604052808381526020013373ffffffffffffffffffffffffffffffffffffffff1681525090806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000015560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505061056f565b808061056790611091565b9150506103ee565b5050565b60001515600360009054906101000a900460ff161515146105c9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105c090610e5c565b60405180910390fd5b600260006105d7919061078e565b600160006105e591906107b2565b565b60001515600360009054906101000a900460ff1615151461063d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161063490610e1c565b60405180910390fd5b60005b81518110156106e0576002604051806040016040528084848151811061066957610668611138565b5b602002602001015181526020016000815250908060018154018082558091505060019003906000526020600020906002020160009091909190915060008201518160000190805190602001906106c09291906107d6565b5060208201518160010155505080806106d890611091565b915050610640565b5050565b60011515600360009054906101000a900460ff1615151461073a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161073190610e7c565b60405180910390fd5b6000600360006101000a81548160ff021916908315150217905550565b600360009054906101000a900460ff1681565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b50805460008255600202906000526020600020908101906107af919061085c565b50565b50805460008255600202906000526020600020908101906107d3919061088b565b50565b8280546107e29061102e565b90600052602060002090601f016020900481019282610804576000855561084b565b82601f1061081d57805160ff191683800117855561084b565b8280016001018555821561084b579182015b8281111561084a57825182559160200191906001019061082f565b5b50905061085891906108d1565b5090565b5b80821115610887576000808201600061087691906108ee565b60018201600090555060020161085d565b5090565b5b808211156108cd576000808201600090556001820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060020161088c565b5090565b5b808211156108ea5760008160009055506001016108d2565b5090565b5080546108fa9061102e565b6000825580601f1061090c575061092b565b601f01602090049060005260206000209081019061092a91906108d1565b5b50565b600061094161093c84610ec1565b610e9c565b905080838252602082019050828560208602820111156109645761096361119b565b5b60005b858110156109b257813567ffffffffffffffff81111561098a57610989611196565b5b8086016109978982610a41565b85526020850194506020840193505050600181019050610967565b5050509392505050565b60006109cf6109ca84610eed565b610e9c565b9050828152602081018484840111156109eb576109ea6111a0565b5b6109f6848285610fec565b509392505050565b600081359050610a0d8161128a565b92915050565b600082601f830112610a2857610a27611196565b5b8135610a3884826020860161092e565b91505092915050565b600082601f830112610a5657610a55611196565b5b8135610a668482602086016109bc565b91505092915050565b600060208284031215610a8557610a846111aa565b5b6000610a93848285016109fe565b91505092915050565b600060208284031215610ab257610ab16111aa565b5b600082013567ffffffffffffffff811115610ad057610acf6111a5565b5b610adc84828501610a13565b91505092915050565b600060208284031215610afb57610afa6111aa565b5b600082013567ffffffffffffffff811115610b1957610b186111a5565b5b610b2584828501610a41565b91505092915050565b6000610b3a8383610d4a565b905092915050565b610b4b81610fa4565b82525050565b6000610b5c82610f43565b610b668185610f66565b935083602082028501610b7885610f1e565b8060005b85811015610bb45784840389528151610b958582610b2e565b9450610ba083610f59565b925060208a01995050600181019050610b7c565b50829750879550505050505092915050565b610bcf81610fb6565b82525050565b6000610be082610f4e565b610bea8185610f77565b9350610bfa818560208601610ffb565b610c03816111af565b840191505092915050565b6000610c1982610f4e565b610c238185610f99565b9350610c33818560208601610ffb565b80840191505092915050565b60008154610c4c8161102e565b610c568186610f99565b94506001821660008114610c715760018114610c8257610cb5565b60ff19831686528186019350610cb5565b610c8b85610f2e565b60005b83811015610cad57815481890152600182019150602081019050610c8e565b838801955050505b50505092915050565b6000610ccb601883610f88565b9150610cd6826111c0565b602082019050919050565b6000610cee601983610f88565b9150610cf9826111e9565b602082019050919050565b6000610d11603983610f88565b9150610d1c82611212565b604082019050919050565b6000610d34601483610f88565b9150610d3f82611261565b602082019050919050565b60006040830160008301518482036000860152610d678282610bd5565b9150506020830151610d7c6020860182610d87565b508091505092915050565b610d9081610fe2565b82525050565b6000610da28284610c0e565b915081905092915050565b6000610db98284610c3f565b915081905092915050565b6000602082019050610dd96000830184610b42565b92915050565b60006020820190508181036000830152610df98184610b51565b905092915050565b6000602082019050610e166000830184610bc6565b92915050565b60006020820190508181036000830152610e3581610cbe565b9050919050565b60006020820190508181036000830152610e5581610ce1565b9050919050565b60006020820190508181036000830152610e7581610d04565b9050919050565b60006020820190508181036000830152610e9581610d27565b9050919050565b6000610ea6610eb7565b9050610eb28282611060565b919050565b6000604051905090565b600067ffffffffffffffff821115610edc57610edb611167565b5b602082029050602081019050919050565b600067ffffffffffffffff821115610f0857610f07611167565b5b610f11826111af565b9050602081019050919050565b6000819050602082019050919050565b60008190508160005260206000209050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b6000610faf82610fc2565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b83811015611019578082015181840152602081019050610ffe565b83811115611028576000848401525b50505050565b6000600282049050600182168061104657607f821691505b6020821081141561105a57611059611109565b5b50919050565b611069826111af565b810181811067ffffffffffffffff8211171561108857611087611167565b5b80604052505050565b600061109c82610fe2565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156110cf576110ce6110da565b5b600182019050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f456c656374696f6e20416c726561647920537461727465640000000000000000600082015250565b7f506572736f6e2068617320616c726561647920766f7465642e00000000000000600082015250565b7f456c656374696f6e20696e2070726f67726573732e436f6e636c75646520697460008201527f20616e64207468656e2074727920616761696e206c6174657200000000000000602082015250565b7f456c656374696f6e204e6f742053746172746564000000000000000000000000600082015250565b61129381610fa4565b811461129e57600080fd5b5056fea2646970667358221220db80f3c1eb719931547fd5c37842d57053d6b5ad92f9a34dda36b92c1c949cd964736f6c63430008070033",
      arguments: [],
    })
    .send(
      {
        from: accounts[0],
        gas: "4700000",
      },
      function (e, contract) {
        console.log(e, contract);
        if (typeof contract.address !== "undefined") {
          console.log(
            "Contract mined! address: " +
              contract.address +
              " transactionHash: " +
              contract.transactionHash
          );
        }
      }
    );
}
run();
